{ # this ensures the entire script is downloaded #

# Define colors
BLUE="\033[0;34m"
GREEN="\033[38;05;70m"
CYAN="\033[0;36m"
RED="\033[38;05;160m"
PURPLE="\033[0;35m"
BROWN="\033[0;33m"
LIGHTGREY="\033[0;37m"
DARKGREY="\033[1;30m"
LIGHTBLUE="\033[1;34m"
LIGHTGREEN="\033[1;32m"
LIGHTCYAN="\033[1;36m"
LIGHTRED="\033[1;31m"
LIGHTPURPLE="\033[1;35m"
YELLOW="\033[1;33m"
WHITE="\033[1;37m"
CURSOR="\033[00m";

# FUNCTION FOR ECHO WITH COLOR OPTION
# ###################################################################
function ech() {
	if [ -z "$2" ]; then
		echo -e " ${GREEN}$1${CURSOR}";
	else
		echo -e "${CURSOR}$1${CURSOR}";
	fi
}

# FUNCTION TO TEST FOR OSX/LINUX/ETC
# ###################################################################
function isosx() {
  if [[ $OSTYPE == *"darwin"* ]]; then
    return 0; # true
  else
    return 1; # false
  fi
}

function islinux() {
  if [[ $OSTYPE == *"linux"* ]]; then
    return 0; # true
  else
    return 1; # false
  fi
}


# FUNCTION FOR INSTALLING NODE + RELATED
# ###################################################################
install_node() {
  ech "- Build Essential..."
  if islinux; then
    sudo apt-get -qq install build-essential -y &> /dev/null
  fi

	ech "- NVM..."
  if [ ! -d "$NVM_DIR" ]; then
    curl --silent -o- https://raw.githubusercontent.com/creationix/nvm/v0.32.0/install.sh | bash &> /dev/null;
    export NVM_DIR="/home/rfrankel/.nvm"
    [ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"  # This loads nvm
    nvm install node &> /dev/null 
    nvm use node &> /dev/null
    nvm alias default node &> /dev/null
    npm install -g --silent node-gyp &> /dev/null
  fi

}

# FUNCTION FOR COMMAND LINE 
# ###################################################################
install_cli() {
	ech "- Cloning z..."
  if [ ! -d ~/code/z ]; then
    git clone --quiet https://github.com/rupa/z.git ~/code/z &> /dev/null
  fi

  # Install trash if required
	ech "- Trash..."
  npm install -g trash-cli empty-trash-cli &> /dev/null
  if islinux; then
    sudo apt-get install trash-cli -y &> /dev/null
  fi
  if isosx; then
    brew install --quieter trash-cli
  fi

	# Install dtrx, ncdu, htop if required
  ech "- dtrx, ncdu, htop..."
  if islinux; then
	  sudo apt-get -qq install dtrx ncdu htop -y &> /dev/null
  fi
  if isosx; then
    brew install --quieter dtrx ncdu htop
  fi

  # INSTALL GIT LFS
  ech "- Git LFS..."
  if islinux; then
    hash git-lfs >/dev/null 2>&1 || {
      curl -s https://packagecloud.io/install/repositories/github/git-lfs/script.deb.sh | sudo bash &> /dev/null
      sudo apt-get install git-lfs -y &>/dev/null 
    }
  fi

  # GITCONFIG SYMLINK
  rm -rf ~/.gitconfig
  ln -s ~/dotfiles/git/gitconfig ~/.gitconfig
}

# FUNCTION FOR INSTALLING VIM
# ###################################################################
install_vim() {
	# Delete Existing
	ech "- Delete existing..."
	rm -rf ~/.vimrc
	rm -rf ~/.vim/snippets

	# Symlink New
	ech "- New symlinks..."
	ln -s ~/dotfiles/vimrc/vimrc ~/.vimrc
  if [ -d ~/dotfiles/vimrc/snippets ]; then
  	ln -s ~/dotfiles/vimrc/snippets ~/.vim/snippets 
  fi

	# Install Vundle if Needed
	ech "- Install curl, vim, and vundle..."
  if islinux; then
  	sudo apt-get -qq install curl vim -y &> /dev/null
  fi
  if isosx; then
    brew install --quieter curl vim
  fi
	if [ ! -d ~/.vim/bundle/vundle/ ]; then
	 git clone --quiet https://github.com/gmarik/vundle.git ~/.vim/bundle/vundle &> /dev/null
	fi

	# Create colors directory
	ech "- Create colors directory..."
	if [ ! -d ~/.vim/colors ]; then
	 mkdir ~/.vim/colors
	fi

	# Download VIM theme
	ech "- Downloading theme..."
	if [ ! -f ~/.vim/colors/wombat256mod.vim ]; then
	 curl --silent -L http://www.vim.org/scripts/download_script.php?src_id=13400 > ~/.vim/colors/wombat256mod.vim
	fi

	# Install bundles
	ech "- Install bundles..."
	vim - -i NONE -c VundleUpdate -c quitall >& /dev/null
} #install_vim()

# FUNCTION FOR INSTALLING BASH
# ###################################################################
function install_bash() {
	#DELETE EXISTING .bashrc IF THERE IS ONE
	ech "- Delete existing..."
	rm -rf ~/.bashrc &> /dev/null
	rm -rf ~/.bash_profile &> /dev/null

	#SYM LINK NEW .bashrc FILE
	ech "- Create new symlinks..."
	ln -s ~/dotfiles/bashrc/bashrc.sh ~/.bashrc
	ln -s ~/dotfiles/bashrc/bashrc.sh ~/.bash_profile

	#RELOAD .bashrc
  ech "- Reload bashrc..."
  source ~/.bashrc
}

function install_setup() {
  if isosx; then
    which -s brew
    if [[ $? != 0 ]]; then
      ech "- Installing Homebrew..."
      /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
    fi
  fi

  # LINUX BASICS
  # #############################################################
  if islinux; then
    ech "- APT update..."
    sudo apt-get update &> /dev/null

    ech "- Install Git..."
    sudo apt-get install git -y &> /dev/null
  fi

  # GET REPO
  # #############################################################
	if [ ! -d ~/dotfiles ]; then
		ech "- Cloning dotfiles..."
		git clone --quiet https://github.com/ryan-frankel/dotfiles ~/dotfiles
		cd ~/dotfiles
	else
		ech "- Pulling dotfiles..."
		cd ~/dotfiles
		git pull --quiet origin master 
	fi
}

# ###################################################################
# ###################################################################
# MAIN
# ###################################################################
# ###################################################################
function main() {
	clear

  ech "\nSetting Up..." 2
  ech "==============================================" 2
  install_setup

	ech "\nInstalling Node..." 2
  ech "==============================================" 2
	install_node

	ech "\nInstalling CLI..." 2
  ech "==============================================" 2
	install_cli

	ech "\nInstalling bash..." 2
  ech "==============================================" 2
	install_bash

	ech "\nInstalling vim..." 2
  ech "==============================================" 2
	install_vim

  ech "\nExecuting bash..." 2
	exec bash

	ech "\nInstall completed.\n\n" 2
}

main
} # this ensures the entire script is downloaded #
